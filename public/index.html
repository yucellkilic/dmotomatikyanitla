<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>DM Otomasyon â€” Asistan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    :root {
      --bg: #0f0f13;
      --surface: #18181f;
      --surface-2: #222230;
      --border: #2a2a3a;
      --accent: #a78bfa;
      --accent-glow: rgba(167, 139, 250, .25);
      --accent-dark: #7c5cbf;
      --user-bubble: #312e81;
      --bot-bubble: #1e1e2e;
      --text: #e4e4ed;
      --text-dim: #9292a8;
      --radius: 16px;
      --transition: .25s cubic-bezier(.4, 0, .2, 1);
    }

    html {
      height: 100%;
      -webkit-text-size-adjust: 100%
    }

    body {
      height: 100%;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app {
      display: flex;
      flex-direction: column;
      height: 100dvh;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--surface);
      position: relative;
      overflow: hidden;
    }

    /* MasaÃ¼stÃ¼nde kenarlÄ±k */
    @media(min-width:601px) {
      .app {
        border-left: 1px solid var(--border);
        border-right: 1px solid var(--border);
        box-shadow: 0 0 60px rgba(0, 0, 0, .5);
      }
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: linear-gradient(180deg, var(--surface-2) 0%, var(--surface) 100%);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      min-height: 72px;
    }

    .header-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #6d28d9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      box-shadow: 0 0 18px var(--accent-glow);
      flex-shrink: 0;
    }

    .header-info {
      min-width: 0;
      flex: 1
    }

    .header-info h1 {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -.3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-info p {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 2px;
      display: flex;
      align-items: center;
      gap: 5px
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #34d399;
      display: inline-block;
      animation: pulse 2s infinite;
      flex-shrink: 0;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .4
      }
    }

    /* â”€â”€ Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .messages {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    .messages::-webkit-scrollbar {
      width: 4px
    }

    .messages::-webkit-scrollbar-track {
      background: transparent
    }

    .messages::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px
    }

    .msg {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      line-height: 1.55;
      animation: fadeUp .3s var(--transition) both;
      position: relative;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(8px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .msg.bot {
      align-self: flex-start;
      background: var(--bot-bubble);
      border: 1px solid var(--border);
      border-bottom-left-radius: 4px;
    }

    .msg.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--user-bubble), var(--accent-dark));
      border-bottom-right-radius: 4px;
      color: #fff;
    }

    .msg-time {
      font-size: 10px;
      color: var(--text-dim);
      margin-top: 5px;
      opacity: .7
    }

    .msg.user .msg-time {
      text-align: right;
      color: rgba(255, 255, 255, .5)
    }

    /* typing indicator */
    .typing {
      display: flex;
      gap: 5px;
      padding: 12px 18px;
      align-self: flex-start
    }

    .typing span {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--text-dim);
      animation: bounce .6s infinite alternate;
    }

    .typing span:nth-child(2) {
      animation-delay: .15s
    }

    .typing span:nth-child(3) {
      animation-delay: .3s
    }

    @keyframes bounce {
      to {
        transform: translateY(-5px);
        opacity: .4
      }
    }

    /* â”€â”€ Input Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      background: var(--surface-2);
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }

    .input-bar input {
      flex: 1;
      min-width: 0;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
      outline: none;
      transition: border var(--transition), box-shadow var(--transition);
      -webkit-appearance: none;
    }

    .input-bar input::placeholder {
      color: var(--text-dim)
    }

    .input-bar input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow)
    }

    .send-btn {
      width: 46px;
      height: 46px;
      border-radius: 13px;
      border: none;
      background: linear-gradient(135deg, var(--accent), #6d28d9);
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform var(--transition), box-shadow var(--transition);
      flex-shrink: 0;
      -webkit-tap-highlight-color: transparent;
    }

    .send-btn:hover {
      transform: scale(1.07);
      box-shadow: 0 0 20px var(--accent-glow)
    }

    .send-btn:active {
      transform: scale(.93)
    }

    .send-btn:disabled {
      opacity: .4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none
    }

    .send-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor
    }

    /* â”€â”€ Welcome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .welcome {
      text-align: center;
      padding: 24px 16px 8px;
      animation: fadeUp .5s var(--transition) both;
    }

    .welcome h2 {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 6px
    }

    .welcome p {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.5
    }

    .quick-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 14px;
    }

    .quick-btn {
      padding: 9px 16px;
      border-radius: 20px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--accent);
      font-size: 13px;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--transition);
      -webkit-tap-highlight-color: transparent;
    }

    .quick-btn:hover,
    .quick-btn:active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent)
    }

    /* â”€â”€ Safe area (notch, home bar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @supports(padding-bottom:env(safe-area-inset-bottom)) {
      .input-bar {
        padding-bottom: calc(12px + env(safe-area-inset-bottom))
      }

      .header {
        padding-top: calc(16px + env(safe-area-inset-top))
      }
    }

    /* â”€â”€ Small phones (â‰¤380px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(max-width:380px) {
      .header {
        padding: 12px 14px;
        gap: 10px;
        min-height: 62px
      }

      .header-avatar {
        width: 38px;
        height: 38px;
        font-size: 15px
      }

      .header-info h1 {
        font-size: 14px
      }

      .messages {
        padding: 14px 12px;
        gap: 10px
      }

      .msg {
        font-size: 13px;
        padding: 10px 14px;
        max-width: 88%
      }

      .input-bar {
        padding: 10px 10px;
        gap: 8px
      }

      .input-bar input {
        padding: 10px 14px;
        font-size: 14px;
        border-radius: 10px
      }

      .send-btn {
        width: 42px;
        height: 42px;
        border-radius: 11px
      }

      .welcome h2 {
        font-size: 15px
      }

      .welcome p {
        font-size: 12px
      }

      .quick-btn {
        font-size: 12px;
        padding: 7px 12px
      }
    }

    /* â”€â”€ Regular phones (381â€“600px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(min-width:381px) and (max-width:600px) {
      .messages {
        padding: 18px 14px
      }

      .msg {
        max-width: 86%
      }
    }

    /* â”€â”€ Tablet (601â€“900px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(min-width:601px) and (max-width:900px) {
      .app {
        max-width: 520px
      }

      .msg {
        max-width: 80%;
        font-size: 14.5px
      }
    }

    /* â”€â”€ Desktop (>900px) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(min-width:901px) {
      .app {
        max-width: 560px
      }

      .header {
        padding: 18px 24px
      }

      .messages {
        padding: 24px 22px;
        gap: 14px
      }

      .msg {
        max-width: 78%;
        padding: 14px 18px;
        font-size: 15px
      }

      .input-bar {
        padding: 14px 18px
      }

      .input-bar input {
        padding: 14px 18px;
        font-size: 15px
      }

      .send-btn {
        width: 50px;
        height: 50px;
        border-radius: 14px
      }
    }

    /* â”€â”€ Landscape phone fix â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(max-height:450px) and (orientation:landscape) {
      .header {
        padding: 8px 14px;
        min-height: 50px
      }

      .header-avatar {
        width: 34px;
        height: 34px;
        font-size: 14px
      }

      .header-info h1 {
        font-size: 13px
      }

      .header-info p {
        font-size: 10px
      }

      .messages {
        padding: 10px 12px;
        gap: 8px
      }

      .msg {
        padding: 8px 12px;
        font-size: 13px
      }

      .input-bar {
        padding: 8px 10px
      }

      .input-bar input {
        padding: 8px 12px;
        font-size: 13px
      }

      .send-btn {
        width: 38px;
        height: 38px;
        border-radius: 10px
      }

      .welcome {
        padding: 10px 12px 4px
      }

      .welcome h2 {
        font-size: 14px
      }
    }
  </style>
</head>

<body>

  <div class="app">

    <!-- Header -->
    <div class="header">
      <div class="header-avatar">DM</div>
      <div class="header-info">
        <h1>DM Otomasyon Asistan</h1>
        <p><span class="status-dot"></span> Ã‡evrimiÃ§i â€” hÄ±zlÄ± yanÄ±t</p>
      </div>
    </div>

    <!-- Messages -->
    <div class="messages" id="messages">
      <div class="welcome">
        <h2>HoÅŸ geldiniz! ðŸ‘‹</h2>
        <p>Size lazer epilasyon hizmetlerimiz hakkÄ±nda yardÄ±mcÄ± olabilirim.<br>Fiyat bilgisi almak veya randevu
          oluÅŸturmak iÃ§in yazÄ±n.</p>
        <div class="quick-actions">
          <button class="quick-btn" onclick="sendQuick('Fiyat bilgisi almak istiyorum')">ðŸ’° Fiyat Bilgisi</button>
          <button class="quick-btn" onclick="sendQuick('Randevu almak istiyorum')">ðŸ“… Randevu Al</button>
        </div>
      </div>
    </div>

    <!-- Input Bar -->
    <div class="input-bar">
      <input type="text" id="msgInput" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." autocomplete="off" />
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg viewBox="0 0 24 24">
          <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
        </svg>
      </button>
    </div>

  </div>

  <script>
    const messagesEl = document.getElementById("messages");
    const msgInput = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");
    const userId = "user_" + Math.random().toString(36).slice(2, 9);

    // Enter ile gÃ¶nder
    msgInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); }
    });

    // Mobilde klavye aÃ§Ä±lÄ±nca scroll dÃ¼zelt
    if ("visualViewport" in window) {
      window.visualViewport.addEventListener("resize", () => {
        messagesEl.scrollTop = messagesEl.scrollHeight;
      });
    }

    // HÄ±zlÄ± buton
    function sendQuick(text) {
      msgInput.value = text;
      sendMessage();
    }

    // Zaman damgasÄ±
    function timeStamp() {
      return new Date().toLocaleTimeString("tr-TR", { hour: "2-digit", minute: "2-digit" });
    }

    // Mesaj baloncuÄŸu ekle
    function addBubble(text, type) {
      const welcome = messagesEl.querySelector(".welcome");
      if (welcome) welcome.remove();

      const div = document.createElement("div");
      div.className = "msg " + type;
      div.innerHTML = text.replace(/\n/g, "<br>") + '<div class="msg-time">' + timeStamp() + "</div>";
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Typing gÃ¶stergesi
    function showTyping() {
      const div = document.createElement("div");
      div.className = "typing";
      div.id = "typing";
      div.innerHTML = "<span></span><span></span><span></span>";
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function hideTyping() {
      const el = document.getElementById("typing");
      if (el) el.remove();
    }

    // Mesaj gÃ¶nder
    async function sendMessage() {
      const text = msgInput.value.trim();
      if (!text) return;

      addBubble(text, "user");
      msgInput.value = "";
      sendBtn.disabled = true;
      showTyping();

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId, message: text }),
        });
        const data = await res.json();
        hideTyping();
        addBubble(data.reply, "bot");
      } catch (err) {
        hideTyping();
        addBubble("BaÄŸlantÄ± hatasÄ±. LÃ¼tfen tekrar deneyin.", "bot");
      }

      sendBtn.disabled = false;
      msgInput.focus();
    }
  </script>

</body>

</html>